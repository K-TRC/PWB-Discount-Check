<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Buy Discount Logic Check</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --pwb-purple: #4b196b; --pwb-orange: #f37021; --pwb-light-orange: #fff4ed; }
        body { font-family: 'Kanit', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background-color: white; width: 100%; max-width: 900px; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 30px rgba(0,0,0,0.1); }
        .header { background-color: var(--pwb-purple); padding: 15px 30px; display: flex; align-items: center; border-bottom: 6px solid var(--pwb-orange); }
        .logo-img { height: 50px; margin-right: 20px; }
        .header-title { color: white; font-size: 22px; }
        .main-layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; padding: 25px; }
        @media (max-width: 768px) { .main-layout { grid-template-columns: 1fr; } }
        label { display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600; color: #333; }
        .input-group { display: flex; align-items: center; margin-bottom: 15px; }
        /* ‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô Row */
        .hidden-row { display: none !important; }
        .prefix { width: 130px; font-size: 13px; color: #666; }
        .unit { width: 50px; font-size: 13px; color: #999; margin-left: 8px; }
        input, select { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; text-align: right; font-family: 'Kanit'; }
        select { text-align-last: right; cursor: pointer; }
        .result-container { background-color: var(--pwb-light-orange); border-left: 6px solid var(--pwb-purple); padding: 20px; border-radius: 8px; }
        .res-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 4px; }
        .val-wrap { font-weight: bold; color: var(--pwb-orange); }
        .net-pay { margin-top: 20px; text-align: right; }
        .net-amt { font-size: 40px; font-weight: 800; color: var(--pwb-orange); line-height: 1; }
        .footer { padding: 15px 25px; background: #f9f9f9; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; font-family: 'Kanit'; }
        .btn-clear { background: #666; color: white; }
        .btn-copy { background: var(--pwb-purple); color: white; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://i.ibb.co/sp4cx3Dn/image-bfe89e.png" alt="Power Buy" class="logo-img">
        <div class="header-title">Discount Smart Check (Auto-Hide Logic)</div>
    </div>

    <div class="main-layout">
        <div class="input-section">
            <label>1. ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î PLPP</label>
            <div class="input-group"><span class="prefix">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡πâ‡∏≤‡∏¢ MSRP</span><input type="number" id="msrp" placeholder="0.00" oninput="vCalc(this)"><span class="unit">‡∏ö‡∏≤‡∏ó</span></div>
            <div class="input-group"><span class="prefix">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î PLPP</span><input type="number" id="plpp" placeholder="0" oninput="vCalc(this)"><span class="unit">‡∏ö‡∏≤‡∏ó</span></div>

            <label>2. ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î OTP / Member (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</label>
            <div class="input-group" id="row-member">
                <span class="prefix">Member (F6)</span>
                <select id="member" onchange="vCalc(this)">
                    <option value="0">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (0%)</option>
                    <option value="3">Central Card (3%)</option>
                    <option value="5">The 1 Exclusive (5%)</option>
                </select>
                <span class="unit"></span>
            </div>
            <div class="input-group" id="row-otp">
                <span class="prefix">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î OTP</span>
                <input type="number" id="otp" placeholder="0" oninput="vCalc(this)">
                <span class="unit">‡∏ö‡∏≤‡∏ó</span>
            </div>

            <label>3. Redeem The 1 & Other</label>
            <div class="input-group"><span class="prefix">‡πÅ‡∏•‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô T1C</span><input type="number" id="points" placeholder="0" oninput="vCalc(this)"><span class="unit">pts</span></div>
            <div class="input-group"><span class="prefix">On-top ‡∏ö‡∏±‡∏ï‡∏£/PMCR</span><input type="number" id="ontop" placeholder="0" oninput="vCalc(this)"><span class="unit">%</span></div>
            <div class="input-group"><span class="prefix">‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</span><input type="number" id="coupon" placeholder="0" oninput="vCalc(this)"><span class="unit">‡∏ö‡∏≤‡∏ó</span></div>
        </div>

        <div class="display-section">
            <div class="result-container">
                <div class="res-line"><span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á PLPP:</span><span id="r1">0.00</span></div>
                <div class="res-line" id="res-member"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Member:</span><span class="val-wrap" id="dMember">0.00</span></div>
                <div class="res-line" id="res-otp"><span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î OTP:</span><span class="val-wrap" id="dOtp">0.00</span></div>
                <div class="res-line"><span>‡∏•‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</span><span class="val-wrap" id="dPoints">0.00</span></div>
                <div class="res-line"><span>‡∏•‡∏î On-top ‡∏ö‡∏±‡∏ï‡∏£:</span><span class="val-wrap" id="dOntop">0.00</span></div>
                <div class="res-line"><span>‡∏•‡∏î‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á:</span><span class="val-wrap" id="dCoupon">0.00</span></div>

                <div class="net-pay">
                    <div style="font-size:13px; font-weight:bold;">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏´‡∏ô‡πâ‡∏≤ POS:</div>
                    <div class="net-amt"><span id="netPay">0.00</span> <small style="font-size:18px; color:#333;">‡∏ö‡∏≤‡∏ó</small></div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <button class="btn btn-copy" onclick="copySummary()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤</button>
        <button class="btn btn-clear" onclick="resetAll()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
</div>

<script>
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©
    document.querySelectorAll('input').forEach(inp => {
        inp.addEventListener('keydown', e => { if(['-','+','e','E'].includes(e.key)) e.preventDefault(); });
    });

    function vCalc(el) {
        if (el.tagName === 'INPUT' && el.value < 0) el.value = 0;
        if (el.id === 'ontop' && el.value > 100) el.value = 100;
        
        const otpVal = parseFloat(document.getElementById('otp').value) || 0;
        const memberVal = parseFloat(document.getElementById('member').value) || 0;

        // Logic ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á: ‡∏´‡∏≤‡∏Å‡πÉ‡∏™‡πà OTP ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô Member
        if (otpVal > 0) {
            document.getElementById('row-member').classList.add('hidden-row');
            document.getElementById('res-member').classList.add('hidden-row');
            document.getElementById('member').value = "0"; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ Member
        } else {
            document.getElementById('row-member').classList.remove('hidden-row');
            document.getElementById('res-member').classList.remove('hidden-row');
        }

        // Logic ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á: ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Member ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô OTP
        if (memberVal > 0) {
            document.getElementById('row-otp').classList.add('hidden-row');
            document.getElementById('res-otp').classList.add('hidden-row');
            document.getElementById('otp').value = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ OTP
        } else {
            document.getElementById('row-otp').classList.remove('hidden-row');
            document.getElementById('res-otp').classList.remove('hidden-row');
        }

        calculate();
    }

    function calculate() {
        const msrp = parseFloat(document.getElementById('msrp').value) || 0;
        const plpp = parseFloat(document.getElementById('plpp').value) || 0;
        const memberPer = parseFloat(document.getElementById('member').value) || 0;
        const otp = parseFloat(document.getElementById('otp').value) || 0;
        const points = parseFloat(document.getElementById('points').value) || 0;
        const ontopPer = parseFloat(document.getElementById('ontop').value) || 0;
        const coupon = parseFloat(document.getElementById('coupon').value) || 0;

        // 1. ‡∏´‡∏•‡∏±‡∏á PLPP
        let afterPLPP = Math.max(0, msrp - plpp);
        document.getElementById('r1').innerText = afterPLPP.toLocaleString(undefined,{minimumFractionDigits:2});

        // 2. ‡∏´‡∏±‡∏Å Member (‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô OTP ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ 2.1)
        let discMember = afterPLPP * (memberPer / 100);
        let afterMem = Math.max(0, afterPLPP - discMember);
        document.getElementById('dMember').innerText = "-" + discMember.toLocaleString(undefined,{minimumFractionDigits:2});

        // 3. ‡∏´‡∏±‡∏Å OTP
        let afterOTP = Math.max(0, afterMem - otp);
        document.getElementById('dOtp').innerText = "-" + otp.toLocaleString(undefined,{minimumFractionDigits:2});

        // 4. ‡∏´‡∏±‡∏Å Redeem Points (8:1)
        let discPoints = points / 8;
        let afterPts = Math.max(0, afterOTP - discPoints);
        document.getElementById('dPoints').innerText = "-" + discPoints.toLocaleString(undefined,{minimumFractionDigits:2});

        // 5. ‡∏´‡∏±‡∏Å On-top ‡∏ö‡∏±‡∏ï‡∏£/PMCR
        let discOntop = afterPts * (ontopPer / 100);
        let afterOntop = Math.max(0, afterPts - discOntop);
        document.getElementById('dOntop').innerText = "-" + discOntop.toLocaleString(undefined,{minimumFractionDigits:2});

        // 6. ‡∏´‡∏±‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
        let net = Math.max(0, afterOntop - coupon);
        document.getElementById('dCoupon').innerText = "-" + coupon.toLocaleString(undefined,{minimumFractionDigits:2});
        
        document.getElementById('netPay').innerText = net.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
    }

    function copySummary() {
        const net = document.getElementById('netPay').innerText;
        if(net === "0.00") return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
        navigator.clipboard.writeText(`üõí ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î Power Buy\n‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${net} ‡∏ö‡∏≤‡∏ó`).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß!"));
    }

    function resetAll() {
        document.querySelectorAll('input').forEach(i => i.value = '');
        document.getElementById('member').value = "0";
        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        document.getElementById('row-member').classList.remove('hidden-row');
        document.getElementById('row-otp').classList.remove('hidden-row');
        document.getElementById('res-member').classList.remove('hidden-row');
        document.getElementById('res-otp').classList.remove('hidden-row');
        calculate();
    }
</script>
</body>
</html>
